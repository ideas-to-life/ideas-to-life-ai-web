---
import BaseLayout from '../layouts/BaseLayout.astro';
import Hero from '../components/Hero.astro';
import ExperimentCard from '../components/ExperimentCard.astro';
import WeeklyLearningCard from '../components/WeeklyLearningCard.astro';

import { getCollection, getEntry, type CollectionEntry } from 'astro:content';

const home = await getEntry('pages', 'home');
const experiments = await getCollection('experiments');
const learnings = await getCollection('learnings');
const weeklyLearnings = learnings.filter((entry): entry is CollectionEntry<'learnings'> & { data: { type: 'weekly' } } => {
    return !entry.data.draft && entry.data.type === 'weekly';
});
const latestLearning = weeklyLearnings.sort((a, b) => (b.data.date?.valueOf() ?? 0) - (a.data.date?.valueOf() ?? 0))[0];

if (!home) {
    throw new Error('Home page content not found');
}

const { data } = home;

const focusItems = [
  { icon: '✅', text: 'Solving real, everyday problems' },
  { icon: '✅', text: 'Moving from idea → usable experience' },
  { icon: '✅', text: 'Architecting systems with people in mind' },
  { icon: '✅', text: 'Applying the right tools to the right problems' },
  { icon: '✅', text: 'Balancing AI autonomy + human intent' },
  { icon: '✅', text: 'Publishing learnings publicly' }
];

const steps = [
  'Real-world problems',
  'Clear hypotheses',
  'Validate early',
  'Smallest useful solution',
  'Ship to production',
  'Learn, iterate, or kill'
];
---

<BaseLayout title={data.title} description={data.description}>
  
  <Hero 
    headline={data.heroTitle ?? ""} 
    subheadline={data.heroSubtitle ?? ""}
    details={data.heroDetails}
  />

  <main class="space-y-32">
    <!-- Why Section -->
    <section id="why" class="max-w-4xl mx-auto px-6 text-center">
      <h2 class="font-display text-4xl font-bold mb-12">{data.whyTitle ?? ""}</h2>
      <div class="glass p-12 rounded-[2rem] space-y-8">
        <p class="text-2xl font-medium leading-relaxed">
          {data.whyText ?? ""}
        </p>
        <div class="text-left space-y-4 max-w-lg mx-auto text-white/70">
          {data.whyBullets?.map((bullet: string) => (
            <p>• {bullet}</p>
          ))}
        </div>
      </div>
    </section>

    <!-- Focus Section -->
    <section id="focus" class="max-w-[1100px] mx-auto px-6">
      <div class="text-center mb-16">
        <h2 class="font-display text-4xl font-bold mb-4">{data.focusTitle ?? ""}</h2>
        <p class="text-white/50 text-xl text-center">{data.focusSubtitle ?? ""}</p>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {focusItems.map(item => (
          <div class="bg-white/5 border border-white/5 p-8 rounded-3xl flex gap-4 items-center">
            <span class="text-2xl">{item.icon}</span>
            <span class="font-medium">{item.text}</span>
          </div>
        ))}
      </div>
    </section>

    <!-- Experiments Section -->
    <section id="experiments" class="max-w-[1100px] mx-auto px-6">
      <div class="mb-16">
        <h2 class="font-display text-4xl font-bold mb-4">{data.experimentsTitle ?? ""}</h2>
        <p class="text-white/50 text-xl">{data.experimentsSubtitle ?? ""}</p>
      </div>
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        {experiments.map(exp => (
          <ExperimentCard experiment={exp} />
        ))}
      </div>
    </section>

    <!-- Process Section -->
    <section id="how" class="max-w-[1100px] mx-auto px-6 text-center">
      <h2 class="font-display text-4xl font-bold mb-4">{data.howTitle ?? ""}</h2>
      <p class="text-white/50 text-xl mb-16">{data.howSubtitle ?? ""}</p>
      
      <div class="flex flex-wrap items-center justify-between gap-8 relative">
        <!-- Connecting Line (Desktop) -->
        <div class="hidden lg:block absolute top-[25px] left-0 w-full h-[2px] bg-white/10 -z-10"></div>
        
        {steps.map((step, i) => (
          <div class="flex-1 min-w-[150px] space-y-4">
            <div class="w-12 h-12 rounded-full bg-gradient-to-tr from-accent-blue to-accent-violet flex items-center justify-center font-extrabold mx-auto shadow-[0_0_20px_rgba(0,210,255,0.3)]">
              {i + 1}
            </div>
            <p class="font-medium text-sm md:text-base">{step}</p>
          </div>
        ))}
      </div>
    </section>

    <!-- Latest Learning Section -->
    {latestLearning && (
        <section id="learnings" class="max-w-[1100px] mx-auto px-6">
            <div class="mb-12 text-center">
                <h2 class="font-display text-4xl font-bold mb-4">Latest Learning</h2>
                <p class="text-white/50 text-xl">Fresh insights from the lab.</p>
            </div>
            <div class="max-w-2xl mx-auto">
                <WeeklyLearningCard learning={latestLearning} />
            </div>
            <div class="mt-8 text-center">
                 <a href="/learnings" class="text-white/50 hover:text-white transition-colors border-b border-transparent hover:border-white/50 pb-1">View all learnings →</a>
            </div>
        </section>
    )}

    <!-- Join Section -->
    <section id="journey" class="max-w-4xl mx-auto px-6 text-center pb-20">
      <div class="glass p-16 rounded-[3rem] space-y-12">
        <h2 class="font-display text-5xl font-bold">{data.joinTitle ?? ""}</h2>
        <p class="text-xl text-white/70 max-w-2xl mx-auto">
          {data.joinText ?? ""}
        </p>
        <div class="flex flex-wrap items-center justify-center gap-4">
          <a href="https://www.linkedin.com/in/avfranco" class="px-8 py-4 bg-accent-blue text-black font-bold rounded-full hover:shadow-[0_0_30px_rgba(0,210,255,0.4)] transition-all">
            Follow on LinkedIn
          </a>
          <a href="https://github.com/ideas-to-life" target="_blank" rel="noopener noreferrer" class="px-8 py-4 bg-white/5 hover:bg-white/10 font-bold rounded-full transition-all">
            Watch on GitHub
          </a>
        </div>
      </div>
    </section>
  </main>

</BaseLayout>
